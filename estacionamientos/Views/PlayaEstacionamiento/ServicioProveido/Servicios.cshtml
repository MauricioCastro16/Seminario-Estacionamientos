@model estacionamientos.ViewModels.ServiciosViewModel

@{
    ViewData["Title"] = "Servicios Disponibles";
}

<form asp-action="AsignarServicios" asp-route-plyID="@Model.PlayaID"
      method="post"
      class="container d-flex flex-column gap-3 align-items-center"
      style="max-width:1000px;">
    <h1 class="display-6 fw-semibold">@ViewData["Title"]</h1>
    <h6 class="text-muted">Playa: @Model.PlayaNom</h6>

    <div class="row row-cols-1 row-cols-md-3 g-4">
        @for (int i = 0; i < Model.ServiciosDisponibles.Count; i++)
        {
            var servicio = Model.ServiciosDisponibles[i];
            bool seleccionado = Model.ServiciosAsignados.Contains(servicio.SerID);
            string cid = $"ser_{servicio.SerID}";

            // Elegir icono segÃºn el tipo de servicio
            string icon = "bi-gear";
            if (servicio.SerTipo.ToLower().Contains("estacionamiento")) icon = "bi-car";
            else if (servicio.SerTipo.ToLower().Contains("lavado")) icon = "bi-bucket";
            else if (servicio.SerTipo.ToLower().Contains("mantenimiento")) icon = "bi-tools";

            <div class="col">
                <label class="card servicio-card d-flex gap-3 flex-row align-items-center px-3 py-2 w-100"
                       style="cursor:pointer;"
                       for="@cid">
                    <input type="checkbox"
                           id="@cid"
                           name="ServiciosAsignados"
                           value="@servicio.SerID"
                           class="form-check-input me-2"
                           @(seleccionado ? "checked" : "") />

                    <div class="d-flex align-items-center gap-3 flex-grow-1">
                        <i class="bi @icon fs-3 text-primary"></i>
                        <div class="text-center flex-grow-1">
                            <h5 class="card-title mb-1">@servicio.SerNom</h5>
                            <p class="m-0 text-muted small">@servicio.SerDesc</p>
                        </div>
                    </div>
                </label>
            </div>
        }
    </div>

    <input type="hidden" name="PlayaID" value="@Model.PlayaID" />

    <div class="d-flex w-100 mt-4 gap-2">
        <button type="submit" class="btn btn-primary flex-fill" id="btnGuardar">Guardar Cambios</button>
        <a asp-controller="PlayaEstacionamiento" asp-action="Index" class="btn btn-outline-secondary flex-fill">Cancelar</a>
    </div>
</form>

<style>
/* Tarjeta base */
.servicio-card {
    transition: all .2s ease-in-out;
    border: 1px solid var(--bs-border-color);
    border-radius: .75rem;
}

/* No seleccionado */
.servicio-card:not(:has(input:checked)) {
    opacity: .6;
    background-color: var(--bs-light);
}

/* Seleccionado */
.servicio-card:has(input:checked) {
    opacity: 1;
    background-color: var(--bs-primary-bg-subtle);
    box-shadow: 0 0 0 .2rem rgba(var(--bs-primary-rgb), .2);
    border-color: rgba(var(--bs-primary-rgb), .5);
}
</style>

@section Scripts {
<script>
  // Fallback para navegadores sin :has()
  document.addEventListener('DOMContentLoaded', () => {
    document.querySelectorAll('.servicio-card').forEach(c => {
      const chk = c.querySelector('input[type="checkbox"]');
      if (!chk) return;
      function sync() {
        if (chk.checked) {
          c.classList.add('is-on');
        } else {
          c.classList.remove('is-on');
        }
      }
      sync();
      chk.addEventListener('change', sync);
    });
  });
</script>
}
