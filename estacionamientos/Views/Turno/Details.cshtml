@model estacionamientos.Models.Turno
@using System

@{
    ViewData["Title"] = "Detalle de turno";

    // --- NUEVO: tomar returnUrl si viene por query ---
    var returnUrl = Context.Request.Query["returnUrl"].ToString();
    var backHref  = !string.IsNullOrWhiteSpace(returnUrl) ? returnUrl : Url.Action("Index","Turno");

    DateTime ToCba(DateTime dt)
    {
        if (dt.Kind == DateTimeKind.Unspecified)
            dt = DateTime.SpecifyKind(dt, DateTimeKind.Utc);
        if (dt.Kind == DateTimeKind.Local)
            dt = dt.ToUniversalTime();

        var tz = TimeZoneInfo.FindSystemTimeZoneById("America/Argentina/Cordoba");
        return TimeZoneInfo.ConvertTimeFromUtc(dt, tz);
    }

    string Fmt(DateTime? dt) => dt.HasValue ? ToCba(dt.Value).ToString("dd/MM/yyyy HH:mm") : "-";
}

<div class="container py-3">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h3 class="mb-0">Detalle de turno</h3>
        <a class="btn btn-secondary" href="@backHref">Volver</a>
    </div>

    <dl class="row">
        <dt class="col-sm-3">Playa</dt>
        <dd class="col-sm-9">@Model.Playa?.PlyCiu @Model.Playa?.PlyDir</dd>

        <dt class="col-sm-3">Playero</dt>
        <dd class="col-sm-9">@Model.Playero?.UsuNyA</dd>

        <dt class="col-sm-3">Inicio</dt>
        <dd class="col-sm-9">@Fmt(Model.TurFyhIni)</dd>

        <dt class="col-sm-3">Fin</dt>
        <dd class="col-sm-9">@Fmt(Model.TurFyhFin)</dd>

        <dt class="col-sm-3">Apertura de caja</dt>
        <dd class="col-sm-9">@((Model.TurApertCaja?.ToString("N2") ?? "-"))</dd>

        <dt class="col-sm-3">Cierre de caja</dt>
        <dd class="col-sm-9">@((Model.TurCierrCaja?.ToString("N2") ?? "-"))</dd>

        @{
            decimal? total = (Model.TurApertCaja.HasValue || Model.TurCierrCaja.HasValue)
                ? (Model.TurCierrCaja ?? 0) - (Model.TurApertCaja ?? 0)
                : (decimal?)null;
        }
        <dt class="col-sm-3">Total del turno</dt>
        <dd class="col-sm-9">@((total?.ToString("N2") ?? "-"))</dd>
    </dl>
</div>
