@model estacionamientos.ViewModels.InformeDuenioVM
@{
    ViewData["Title"] = "Informes";
    var k = Model.Kpis;
}

<div class="container">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="mb-0">Informes</h1>
        <a class="btn btn-primary" asp-controller="Informes" asp-action="Index"
           asp-route-desde="@Model.Filtros.Desde.ToString("yyyy-MM-dd")"
           asp-route-hasta="@Model.Filtros.Hasta.ToString("yyyy-MM-dd")">
            <i class="fa-solid fa-rotate-right"></i> Actualizar
        </a>
    </div>

    <!-- KPIs -->
    <div class="row g-3 mb-4">
        <div class="col-12 col-md-4">
            <div class="card shadow-sm">
                <div class="card-body">
                    <div class="text-muted small">Ingresos Totales</div>
                    <div class="h4 m-0">$ @k.IngresosTotales.ToString("N2")</div>
                </div>
            </div>
        </div>
        <div class="col-6 col-md-4">
            <div class="card shadow-sm">
                <div class="card-body">
                    <div class="text-muted small">Cantidad de Pagos</div>
                    <div class="h4 m-0">@k.CantPagos</div>
                </div>
            </div>
        </div>
        <div class="col-6 col-md-4">
            <div class="card shadow-sm">
                <div class="card-body">
                    <div class="text-muted small">Ticket Promedio</div>
                    <div class="h4 m-0">$ @(k.TicketPromedio.ToString("N2"))</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mix por método de pago -->
    <div class="card shadow-sm mb-4">
        <div class="card-body">
            <h5 class="card-title mb-3">Mix por método de pago</h5>
            @if (k.MixMetodos?.Any() == true)
            {
                <div class="table-responsive">
                    <table class="table table-sm align-middle">
                        <thead>
                            <tr>
                                <th>Método</th>
                                <th class="text-end">Monto</th>
                                <th class="text-end"># Pagos</th>
                                <th class="text-end">% del Total</th>
                            </tr>
                        </thead>
                        <tbody>
                        @foreach (var m in k.MixMetodos)
                        {
                            <tr>
                                <td>@m.Metodo</td>
                                <td class="text-end">$ @m.Monto.ToString("N2")</td>
                                <td class="text-end">@m.Cantidad</td>
                                <td class="text-end">@m.PorcentajeMonto.ToString("0.0")%</td>
                            </tr>
                        }
                        </tbody>
                    </table>
                </div>
            }
            else
            {
                <div class="text-muted">Sin datos en el período.</div>
            }
        </div>
    </div>

    <!-- Desglose por playa -->
    <div class="card shadow-sm">
        <div class="card-body">
            <h5 class="card-title mb-3">Desglose por playa</h5>

            @if (Model.PorPlaya?.Any() == true)
            {
                <div class="table-responsive">
                    <table class="table table-striped align-middle">
                        <thead>
                            <tr>
                                <th>Playa</th>
                                <th class="text-end"># Pagos</th>
                                <th class="text-end">Ingresos</th>
                                <th class="text-end">Ticket Prom.</th>
                            </tr>
                        </thead>
                        <tbody>
                        @foreach (var r in Model.PorPlaya)
                        {
                            <tr>
                                <td>@r.PlayaNombre</td>
                                <td class="text-end">@r.CantPagos</td>
                                <td class="text-end">$ @r.IngresosTotales.ToString("N2")</td>
                                <td class="text-end">$ @r.TicketPromedio.ToString("N2")</td>
                            </tr>
                        }
                        </tbody>
                    </table>
                </div>
            }
            else
            {
                <div class="text-muted">Todavía no hay pagos registrados para generar informes.</div>
            }
        </div>
    </div>
</div>
