@model IEnumerable<estacionamientos.Models.Ocupacion>

@{
    ViewData["Title"] = "Ocupaciones";
}

@if (TempData["Success"] != null)
{
    <div class="alert alert-success alert-dismissible fade show" role="alert">
        @TempData["Success"]
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
}

@if (TempData["Error"] != null)
{
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
        @TempData["Error"]
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
}


<div class="d-flex justify-content-between align-items-center mb-3">
    <h2 class="mb-0">Ocupaciones</h2>
    <a asp-action="Create" class="btn btn-primary">
        <i class="bi bi-plus"></i> Ingresar Vehículo
    </a>
</div>

<table class="table table-striped">
    <thead>
        <tr>
            <th>Plaza</th>
            <th>Clasificación</th>
            <th>Patente</th>
            <th>Ingreso</th>
            <th>Egreso</th>
            <th></th>
        </tr>
    </thead>
    <tbody>
@foreach (var item in Model)
{
        <tr>
            <td>@item.PlzNum</td>
            <td>@item.Vehiculo?.Clasificacion?.ClasVehTipo</td>
            <td>@item.VehPtnt</td>
            <td>@item.OcufFyhIni.ToLocalTime().ToString("g")</td>
            <td>
                @(item.OcufFyhFin?.ToLocalTime().ToString("g") ?? "En curso")
            </td>

            <td>
                @if (item.OcufFyhFin == null)
                {
                    <form asp-action="RegistrarEgreso" method="post">
                        <input type="hidden" name="plyID" value="@item.PlyID" />
                        <input type="hidden" name="plzNum" value="@item.PlzNum" />
                        <input type="hidden" name="vehPtnt" value="@item.VehPtnt" />
                        <button type="submit" class="btn btn-danger btn-sm">Egresar</button>
                    </form>
                }
                else
                {
                    <span class="text-success">Finalizado</span>
                }
            </td>
        </tr>
}
    </tbody>
</table>

@section Scripts {
<script>
    // Oculta automáticamente los alerts después de 3 segundos
    setTimeout(() => {
        document.querySelectorAll('.alert').forEach(alert => {
            const bsAlert = bootstrap.Alert.getOrCreateInstance(alert);
            bsAlert.close();
        });
    }, 3000);
</script>
}
