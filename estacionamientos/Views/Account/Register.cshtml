@model estacionamientos.Models.ViewModels.Auth.RegisterViewModel
@{
    ViewData["Title"] = "Registro de Conductor";
}

<div class="row justify-content-center">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h2 class="text-center mb-0">@ViewData["Title"]</h2>
            </div>
            <div class="card-body">
                <!-- Para mostrar mensaje de éxito -->
                @if (TempData["SuccessMessage"] != null)
                {
                    <div class="alert alert-success alert-dismissible fade show" role="alert">
                        @TempData["SuccessMessage"]
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                }

                <!-- Para mostrar mensajes de error -->
                <div asp-validation-summary="ModelOnly" class="text-danger mb-3"></div>

                <form asp-action="Register" method="post">
                    @Html.AntiForgeryToken()

                    <div class="mb-3">
                        <label asp-for="UsuNyA" class="form-label"></label>
                        <input asp-for="UsuNyA" class="form-control" placeholder="Ej: Juan Pérez" />
                        <span asp-validation-for="UsuNyA" class="text-danger"></span>
                    </div>

                    <div class="mb-3">
                        <label asp-for="UsuNomUsu" class="form-label"></label>
                        <input asp-for="UsuNomUsu" class="form-control" placeholder="Ej: juanperez" />
                        <span asp-validation-for="UsuNomUsu" class="text-danger"></span>
                    </div>

                    <div class="mb-3">
                        <label asp-for="UsuEmail" class="form-label"></label>
                        <input asp-for="UsuEmail" class="form-control" type="email" placeholder="Ej: juan@email.com" />
                        <span asp-validation-for="UsuEmail" class="text-danger"></span>
                    </div>

                    <div class="mb-3">
                        <label asp-for="UsuPswd" class="form-label"></label>
                        <div class="input-group">
                            <input asp-for="UsuPswd" class="form-control" type="password" id="passwordInput" placeholder="Mínimo 8 caracteres" />
                            <button type="button" class="btn btn-outline-secondary" id="togglePassword">
                                <i class="fa-solid fa-eye"></i>
                            </button>
                        </div>
                        <span asp-validation-for="UsuPswd" class="text-danger"></span>
                    </div>

                    <div class="mb-3">
                        <label asp-for="ConfirmPassword" class="form-label"></label>
                        <div class="input-group">
                            <input asp-for="ConfirmPassword" class="form-control" type="password" id="confirmPasswordInput" placeholder="Repite tu contraseña" />
                            <button type="button" class="btn btn-outline-secondary" id="toggleConfirmPassword">
                                <i class="fa-solid fa-eye"></i>
                            </button>
                        </div>
                        <span asp-validation-for="ConfirmPassword" class="text-danger"></span>
                    </div>

                    <div class="mb-3">
                        <label asp-for="UsuNumTel" class="form-label"></label>
                        <input asp-for="UsuNumTel" class="form-control" type="tel" placeholder="Ej: +54 9 11 1234-5678" />
                        <span asp-validation-for="UsuNumTel" class="text-danger"></span>
                    </div>

                    <div class="form-check mb-3">
                        <input asp-for="AcceptTerms" class="form-check-input" type="checkbox" />
                        <label asp-for="AcceptTerms" class="form-check-label">
                            Acepto los <a href="#" data-bs-toggle="modal" data-bs-target="#termsModal" class="text-decoration-none">términos y condiciones</a>
                        </label>
                        <span asp-validation-for="AcceptTerms" class="text-danger d-block"></span>
                    </div>

                    <div class="d-grid gap-2">
                        <button type="submit" class="btn btn-primary btn-lg">Registrarse</button>
                        <a asp-action="Login" class="btn btn-outline-secondary">¿Ya tienes cuenta? Iniciar sesión</a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Modal de términos y condiciones -->
<div class="modal fade" id="termsModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Términos y Condiciones</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <h6>1. Registro como Conductor</h6>
                <p>Al registrarte como conductor, aceptas utilizar el sistema de estacionamientos de manera responsable y cumplir con todas las normativas establecidas.</p>
                
                <h6>2. Responsabilidades</h6>
                <p>Como conductor, eres responsable de:</p>
                <ul>
                    <li>Proporcionar información veraz y actualizada</li>
                    <li>Respetar las tarifas y horarios de los estacionamientos</li>
                    <li>Mantener la seguridad de tu cuenta</li>
                </ul>
                
                <h6>3. Privacidad</h6>
                <p>Tu información personal será protegida según nuestras políticas de privacidad.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        // Toggle para mostrar/ocultar contraseña
        const togglePassword = document.querySelector("#togglePassword");
        const passwordInput = document.querySelector("#passwordInput");
        const passwordIcon = togglePassword.querySelector("i");

        togglePassword.addEventListener("click", function () {
            const type = passwordInput.getAttribute("type") === "password" ? "text" : "password";
            passwordInput.setAttribute("type", type);
            passwordIcon.classList.toggle("fa-eye");
            passwordIcon.classList.toggle("fa-eye-slash");
        });

        // Toggle para mostrar/ocultar confirmación de contraseña
        const toggleConfirmPassword = document.querySelector("#toggleConfirmPassword");
        const confirmPasswordInput = document.querySelector("#confirmPasswordInput");
        const confirmPasswordIcon = toggleConfirmPassword.querySelector("i");

        toggleConfirmPassword.addEventListener("click", function () {
            const type = confirmPasswordInput.getAttribute("type") === "password" ? "text" : "password";
            confirmPasswordInput.setAttribute("type", type);
            confirmPasswordIcon.classList.toggle("fa-eye");
            confirmPasswordIcon.classList.toggle("fa-eye-slash");
        });

        // Validación en tiempo real de contraseñas
        const password = document.querySelector("#passwordInput");
        const confirmPassword = document.querySelector("#confirmPasswordInput");

        function validatePasswords() {
            if (confirmPassword.value && password.value !== confirmPassword.value) {
                confirmPassword.setCustomValidity("Las contraseñas no coinciden");
            } else {
                confirmPassword.setCustomValidity("");
            }
        }

        password.addEventListener("input", validatePasswords);
        confirmPassword.addEventListener("input", validatePasswords);

        // Validación del checkbox de términos
        const acceptTermsCheckbox = document.querySelector('input[name="AcceptTerms"]');
        const form = document.querySelector('form');
        
        form.addEventListener('submit', function(e) {
            if (!acceptTermsCheckbox.checked) {
                e.preventDefault();
                acceptTermsCheckbox.setCustomValidity('Debe aceptar los términos y condiciones');
                acceptTermsCheckbox.reportValidity();
            } else {
                acceptTermsCheckbox.setCustomValidity('');
            }
        });

        // Limpiar validación cuando se marca el checkbox
        acceptTermsCheckbox.addEventListener('change', function() {
            if (this.checked) {
                this.setCustomValidity('');
            }
        });
    </script>
}
